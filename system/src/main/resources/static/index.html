<!DOCTYPE HTML>
<html lang="en">
<head>
    <title>SLY System</title>
</head>

<body>
<div style="width: 100px"><label for="processID">processID </label></div>
<input id="processID" type="text" style="width: 500px; height: 20px" value="9c337a14-f7f4-432e-ab4a-c8e95943d31f"/><br/>
<div style="width: 100px"><label for="task">task </label></div>
<select id="task" style="width: 500px; height: 20px">
    <option value="Handle">Handle</option>
    <option value="Manager">Manager</option>
</select><br/>
<div style="width: 100px"><label for="method">method </label></div>
<input id="method" type="text" style="width: 500px; height: 20px" value="getAllHandle"/><br/>
<div style="width: 100px"><label for="request">request </label></div>
<input id="request" type="text" style="width: 100%; height: 60px" value="{}"/><br/>
<button onclick="send()" style="width: 200px; height: 40px">发送</button>
<button onclick="createWebSocket()" style="width: 200px; height: 40px">连接</button>
<button onclick="closeWebSocket()" style="width: 200px; height: 40px">断开</button>
<div id="message"></div>
</body>

<script type="text/javascript">
    function send() {
        if (websocket == null) {
            return;
        }

        const processID = document.getElementById('processID').value;
        const task = document.getElementById('task').value;
        const method = document.getElementById('method').value;
        const request = document.getElementById('request').value;

        let userContextRequest = {
            "processID": {"id": processID},
            "content": {"task": task, "method": method, "request": JSON.parse(request)}
        };

        let userContextRequestRaw = JSON.stringify(userContextRequest);

        setMessageInnerHTML("输入：" + userContextRequestRaw);
        websocket.send(userContextRequestRaw);
    }

    function setMessageInnerHTML(innerHTML) {
        const text = document.getElementById('message').innerHTML;
        document.getElementById('message').innerHTML = innerHTML + '<br/>' + text;
    }

    let websocket = null;

    function createWebSocket() {
        if (websocket != null) {
            return;
        }

        if ('WebSocket' in window) {
            websocket = new WebSocket("ws://localhost:8080/Call.action");
            setMessageInnerHTML("准备中……");
        } else {
            alert('浏览器不支持……')
        }

        websocket.onerror = function () {
            setMessageInnerHTML("--错误--");
        };

        websocket.onopen = function (event) {
            setMessageInnerHTML("--连接--");
        }

        websocket.onmessage = function (event) {
            setMessageInnerHTML("输出：" + event.data);
        }

        websocket.onclose = function () {
            setMessageInnerHTML("--关闭--");
        }

        window.onbeforeunload = function () {
            websocket.close();
        }
    }

    function closeWebSocket() {
        if (websocket == null) {
            return;
        }

        websocket.close();

        websocket = null;
    }
</script>
</html>